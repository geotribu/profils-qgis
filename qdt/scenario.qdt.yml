# yaml-language-server: $schema=https://raw.githubusercontent.com/Guts/qgis-deployment-cli/main/docs/schemas/scenario/schema.json

metadata:
  title: "Scénario de déploiement des profils Geotribu pour QGIS."
  id: geotribu-profils-qgis
  description: >-
    Scénario QGIS Deployment Toolbelt pour déployer les profils QGIS de Geotribu.

# Toolbelt settings
settings:
  LOCAL_WORK_DIR: ~/.cache/qgis-deployment-toolbelt/Geotribu/
  QGIS_EXE_PATH:
    linux: /usr/bin/qgis
    mac: /usr/bin/qgis
    windows: "%PROGRAMFILES%/QGIS/3_22/bin/qgis-bin.exe"
  SCENARIO_VALIDATION: true

# Deployment workflow, step by step
steps:
  - name: "Synchronise les profils depuis le dépôt Git distant"
    uses: qprofiles-manager
    with:
      action: download
      branch: main
      protocol: git
      source: https://github.com/geotribu/profils-qgis.git
      sync_mode: only_new_version

  - name: "Télécharge les plugins listés dans les profils"
    uses: qplugins-downloader
    with:
      force: false
      threads: 5

  - name: "Synchronise les plugins téléchargés avec ceux présents dans les profils installés"
    uses: qplugins-synchronizer
    with:
      action: create_or_restore

  - name: Set splash screen
    uses: splash-screen-manager
    with:
      action: create_or_restore
      strict: false

  - name: Create shortcuts for profiles
    uses: shortcuts-manager
    with:
      action: create_or_restore
      include:
        - profile: geotribu
          label: "QGIS - Geotribu"
          additional_arguments: "--noversioncheck"
          desktop: true
          start_menu: true
        - profile: conf_qgis_fr_2023
          label: "QGIS - Conf QGIS FR 2023"
          additional_arguments: "--noversioncheck"
          desktop: true
          start_menu: true
